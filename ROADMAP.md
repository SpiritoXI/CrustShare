# CrustShare 后续开发计划

## 已完成功能 ✅

### 核心功能
- ✅ 安全登录系统（密码保护）
- ✅ 文件上传功能（支持拖拽和点击）
- ✅ 实时上传进度显示
- ✅ 文件列表展示
- ✅ 文件搜索和过滤
- ✅ CID 手动添加（单个和批量）
- ✅ 文件重命名
- ✅ 文件删除
- ✅ 一键复制 CID
- ✅ 存储空间统计
- ✅ 用户退出登录
- ✅ 白底彩色水晶UI 设计

## 待实现功能 🚧

### 1. 文件分享功能 🔜
**优先级：高**

**功能描述：**
- 为文件生成独立分享链接
- 支持设置分享时长（1小时、1天、7天、永久）
- 支持密码保护分享
- 支持访问次数限制
- 提供访问统计功能
- 分享页面保持与主页一致的UI风格

**实现步骤：**
1. 创建分享对话框组件 `ShareDialog.tsx`
2. 创建独立分享页面 `app/share/[id]/page.tsx`
3. 实现分享链接生成逻辑
4. 实现分享权限验证（密码、时长）
5. 添加访问统计记录

**技术要点：**
- 使用 localStorage 存储分享配置
- 生成随机分享ID
- 状态管理扩展：添加 share 相关状态

### 2. 网关检测和下载功能 🔜
**优先级：高**

**功能描述：**
- 多网关并发测速，自动选择最快的
- 支持的网关列表：
  - Cloudflare IPFS Gateway
  - IPFS.io Gateway
  - DWeb Link Gateway
  - W3S Link Gateway
  - Crust Network 官方网关
- 网关健康状态监控
- 网关测试缓存（10分钟）
- 自动隐藏不可用网关
- 一键下载文件

**实现步骤：**
1. 创建网关检测服务 `lib/gateway.ts`
2. 实现网关健康检查
3. 创建网关选择组件 `GatewaySelector.tsx`
4. 实现文件下载功能
5. 添加网关性能追踪（30天）

**技术要点：**
- 使用 fetch API 测试网关响应时间
- 网关结果缓存到 localStorage
- 网关状态实时更新
- 支持手动切换网关

### 3. 文件夹管理功能 🔜
**优先级：中**

**功能描述：**
- 创建、删除、重命名文件夹
- 支持嵌套文件夹（树状结构）
- 文件拖拽到文件夹
- 文件夹路径导航
- 面包屑导航
- 文件夹统计（文件数量、总大小）

**实现步骤：**
1. 扩展数据模型，添加文件夹概念
2. 更新状态管理，添加文件夹相关状态
3. 创建文件夹管理组件 `FolderManager.tsx`
4. 实现文件夹树状视图 `FolderTree.tsx`
5. 实现文件移动到文件夹功能

**技术要点：**
- 使用递归渲染文件夹树
- 文件夹路径管理
- 文件拖拽目标识别
- 面包屑导航实现

### 4. 文件批量操作功能 🔜
**优先级：中**

**功能描述：**
- 多选文件（复选框）
- 批量删除
- 批量移动到文件夹
- 批量添加标签
- 全选/反选功能
- 批量导出 CID 列表

**实现步骤：**
1. 在文件列表添加复选框
2. 更新状态管理，添加选择状态
3. 创建批量操作工具栏 `BatchToolbar.tsx`
4. 实现批量删除功能
5. 实现批量移动功能
6. 实现批量标签功能

**技术要点：**
- 复选框状态同步
- 批量操作进度提示
- 确认对话框
- 操作失败回滚

### 5. 文件标签和分类系统 🔜
**优先级：中**

**功能描述：**
- 为文件添加标签
- 创建自定义标签
- 标签颜色自定义
- 按标签筛选文件
- 标签统计
- 标签管理（编辑、删除）

**实现步骤：**
1. 扩展数据模型，添加 tags 字段
2. 创建标签管理组件 `TagManager.tsx`
3. 创建标签选择器组件 `TagSelector.tsx`
4. 实现标签筛选功能
5. 实现标签统计面板

**技术要点：**
- 标签数据结构设计
- 标签唯一性验证
- 颜色选择器集成
- 标签筛选逻辑

### 6. 文件版本控制 🔜
**优先级：低**

**功能描述：**
- 文件版本历史记录
- 查看历史版本
- 恢复到旧版本
- 版本对比
- 版本管理（删除旧版本）

**实现步骤：**
1. 扩展数据模型，添加 versions 字段
2. 创建版本历史组件 `VersionHistory.tsx`
3. 实现版本对比功能
4. 实现版本恢复功能
5. 版本存储优化（仅存储差异）

**技术要点：**
- 版本数据存储策略
- 版本对比算法
- 版本恢复逻辑
- 存储空间优化

### 7. 用户权限管理 🔜
**优先级：低**

**功能描述：**
- 多用户登录
- 角色分配（管理员、普通用户、访客）
- 权限控制（查看、上传、删除、管理）
- 用户管理界面
- 操作日志记录

**实现步骤：**
1. 扩展用户数据模型
2. 实现权限验证中间件
3. 创建用户管理组件 `UserManager.tsx`
4. 实现权限控制逻辑
5. 添加操作日志记录

**技术要点：**
- 权限模型设计
- 权限验证中间件
- 用户界面权限控制
- 日志记录和审计

## 集成服务 🔌

### 1. 集成对象存储 🔜
**优先级：高**

**功能描述：**
- 使用对象存储服务保存文件元数据
- 文件分块存储
- 断点续传
- 大文件支持（超过 40MB）

**实现步骤：**
1. 集成 `integration-s3-storage` 服务
2. 实现文件上传到对象存储
3. 实现文件分块上传
4. 实现断点续传
5. 添加上传重试机制

### 2. 集成大语言模型 🔜
**优先级：中**

**功能描述：**
- AI 文件分类
- AI 文件描述生成
- AI 智能搜索（自然语言）
- AI 推荐相关文件

**实现步骤：**
1. 集成 `integration-doubao-seed` 服务
2. 实现 AI 文件分类
3. 实现智能搜索
4. 添加文件推荐功能

### 3. 集成知识库 🔜
**优先级：低**

**功能描述：**
- 文件内容向量化
- 语义搜索
- 相似文件推荐
- 内容索引

**实现步骤：**
1. 集成 `integration-knowledge-base` 服务
2. 实现文件内容向量化
3. 实现语义搜索
4. 添加相似文件推荐

## 性能优化 ⚡

### 1. 前端优化
- ✅ 代码分割和懒加载
- 🔄 图片优化和延迟加载
- 🔄 虚拟滚动（大量文件列表）
- 🔄 缓存策略优化
- 🔄 Service Worker 离线支持

### 2. 后端优化
- 🔄 API 响应缓存
- 🔄 分页加载
- 🔄 文件列表懒加载
- 🔄 数据库索引优化
- 🔄 CDN 加速

## 安全增强 🔒

### 1. 认证安全
- ✅ 密码哈希加密
- 🔄 Token 认证机制
- 🔄 OAuth2 集成（Google、GitHub）
- 🔄 双因素认证（2FA）

### 2. 数据安全
- 🔄 端到端加密
- 🔄 文件加密存储
- 🔄 访问日志记录
- 🔄 安全审计

## 移动端适配 📱

### 1. 响应式设计
- ✅ 基础响应式布局
- 🔄 移动端专属UI优化
- 🔄 手势操作（滑动、长按）
- 🔄 移动端上传优化

### 2. PWA 支持
- 🔄 PWA Manifest
- 🔄 离线支持
- 🔄 安装提示
- 🔄 推送通知

## 测试计划 🧪

### 1. 单元测试
- 🔄 组件单元测试
- 🔄 工具函数测试
- 🔄 状态管理测试

### 2. 集成测试
- 🔄 API 集成测试
- 🔄 文件上传流程测试
- 🔄 用户操作流程测试

### 3. E2E 测试
- 🔄 端到端用户流程测试
- 🔄 跨浏览器测试
- 🔄 移动端测试

## 部署计划 🚀

### 1. CI/CD 流水线
- 🔄 GitHub Actions 配置
- 🔄 自动化测试
- 🔄 自动化部署
- 🔄 版本管理

### 2. 监控和日志
- 🔄 性能监控
- 🔄 错误追踪
- 🔄 用户行为分析
- 🔄 日志聚合

## 时间线预估 📅

### 第一阶段（核心功能）
- 文件分享功能：1-2 天
- 网关检测和下载：2-3 天

### 第二阶段（增强功能）
- 文件夹管理：3-4 天
- 批量操作：2-3 天
- 标签系统：2-3 天

### 第三阶段（高级功能）
- 版本控制：3-4 天
- 用户权限：3-4 天

### 第四阶段（优化和部署）
- 性能优化：2-3 天
- 安全增强：2-3 天
- 测试和部署：3-4 天

**总计预估：23-33 天（约 1-1.5 个月）**

## 技术债务 📋

### 当前技术债务
- 文件上传是模拟的，需要集成真实的 Crust Network API
- CID 是随机生成的，需要真实上传到 IPFS
- 没有后端API，所有数据存储在 localStorage
- 没有数据库持久化
- 没有文件真实存储

### 偿还计划
1. 集成真实的 Crust Network API
2. 实现后端 API（Next.js API Routes）
3. 集成数据库（PostgreSQL）
4. 实现对象存储集成
5. 实现文件真实存储

## 注意事项 ⚠️

1. **文件大小限制**：免费用户最大支持 40MB，Premium 用户最大支持 1GB
2. **安全考虑**：密码使用 SHA-256 哈希加密存储
3. **网关限制**：必须通过 Crust Network 官方网关上传
4. **IPFS 特性**：IPFS 上的文件永久保存，删除只是记录删除
5. **会话管理**：会话有效期为 24 小时

## 参考资源 📚

- [Crust Network 官方文档](https://docs.crust.network/)
- [IPFS 官方文档](https://docs.ipfs.io/)
- [Next.js 官方文档](https://nextjs.org/docs)
- [shadcn/ui 组件库](https://ui.shadcn.com/)
- [Tailwind CSS 文档](https://tailwindcss.com/docs)
- [Zustand 文档](https://github.com/pmndrs/zustand)

---

**最后更新：2026-01-29**
**维护者：CrustShare 开发团队**
