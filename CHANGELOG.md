# CloudChan 更新日志

## [v2.2.1] - 2026-01-23

### 版本统一与修复
- 统一所有文件版本号为 v2.2.1，确保缓存一致性
- 修复登录页面版本显示问题（从 V1.0.0 更新至 V2.2.1）
- 修复 config.js 版本注释与实际版本号不一致问题
- 更新所有文档版本号至 v2.2.1

### 文档优化
- 重新整理项目文档，统一格式和风格
- 优化 README.md 结构，提升可读性
- 更新 CHANGELOG.md，补充版本历史
- 统一所有文档的版本信息和日期

### 代码优化
- 修复资源版本号缓存问题（CSS/JS 文件版本参数）
- 确保所有资源引用使用统一的版本号 v2.2.1

## [v2.2.0] - 2026-01-22

### 结构与部署
- 静态站点目录统一为 `cloudchan/`，并支持“根站点模式”访问（根路径直接进入应用）
- 调整 Cloudflare Pages 路由规则（`_redirects` / `_headers`），避免静态资源被 SPA 重写误伤

### 功能与稳定性
- 修复分页/过滤场景下删除、重命名、移动可能错位的问题（统一以 `fileId` 定位）
- 新增后端批量接口：`delete_files` / `move_files`，前端批量操作改为单请求调用
- 登录页改为通过后端接口校验密码，避免“任意密码都显示登录成功”的误导

### 文档与规范
- 文档与路径示例统一为中文并对齐当前目录结构
- 资源压缩脚本与关键模块注释统一为中文，规范化版本/构建信息来源

## [v2.1.0] - 2025-01-13

### UI 界面全面升级 🎨
- **现代化设计风格**
  - 采用 Glassmorphism（毛玻璃）设计语言
  - 改进的渐变背景和阴影系统
  - 更丰富的色彩搭配和视觉层次

- **交互动画优化**
  - 添加页面加载动画（fadeInUp）
  - 按钮悬停效果和点击反馈
  - 表格行悬停放大效果
  - 上传区域背景光效动画

- **配色系统重构**
  - 全新的 CSS 变量系统（CSS Variables）
  - 优化的渐变色方案
  - 改进的状态颜色（成功、错误、警告）
  - 更好的文字颜色对比度

- **响应式设计增强**
  - 优化移动端布局（<768px）
  - 改进表格在小屏幕上的显示
  - 自适应按钮和输入框大小
  - 优化的 Toast 通知显示

- **细节优化**
  - 改进版本信息显示区域样式
  - 优化文件表格样式和排版
  - 增强按钮视觉反馈（波纹效果）
  - 改进进度条动画（shimmer 效果）

### 技术改进 ⚙️
- 重写 CSS 文件，代码结构更清晰
- 添加完整的工具类系统
- 改进打印样式支持
- 优化动画性能（GPU 加速）

### 文档更新 📚
- 更新 README.md 中的 UI 预览说明
- 添加 CSS 设计理念说明

---

## [v2.0.0] - 2025-01-13

### 新增功能 ⭐
- **网关健康追踪系统**
  - 追踪每个网关的成功/失败次数、连续失败次数
  - 记录最后成功/失败时间和健康分数
  - 30天持久化存储健康状态

- **网关自动清理机制**
  - 基于多条规则识别长期不可用网关
    - 失败次数过多（默认：5次）
    - 连续失败次数过多（默认：3次）
    - 长时间未使用（默认：30天）
    - 健康分数过低（默认：10分）
  - 保护默认网关（优先级 <= 10）
  - 支持手动清理，提供清理预览

- **网关智能排序**
  - 基于健康分数、延迟、优先级综合排序
  - 优先推荐健康、快速的网关
  - 自动识别并排序 CN 地区网关

- **手动管理界面**
  - 新增"清理"按钮，一键清理无效网关
  - 清理预览功能，显示待清理网关和原因
  - 保留"重置"功能，可恢复默认网关列表

### 优化改进 🚀
- **网关健康状态数据结构优化**
  - 新增 `successCount`, `failureCount`, `consecutiveFailures` 等指标
  - 升级健康缓存版本 (`cc_gateway_health_v2`)
  - 延长缓存有效期至 30 天

- **网关测试逻辑增强**
  - 使用 `updateGatewayHealth` 函数更新健康状态
  - 每次测试后自动更新成功/失败计数
  - 支持重试机制，连续失败自动计数

### 文档更新 📚
- 新增 `GATEWAY_HEALTH_CLEANUP.md` - 网关健康追踪详细技术文档
- 更新 `OPTIMIZATION_SUMMARY.md` - 添加 V2.0 优化内容
- 更新主页说明，展示新功能

### 配置更新 ⚙️
- 新增 `GATEWAY_HEALTH` 配置项
- 新增 `CLEANUP` 子配置项（清理规则）
- 新增 `SCORING` 子配置项（评分规则）

### 打包更新 📦
- 更新 `cloudchan-package.tar.gz` (25KB)
- 包含所有优化后的代码和文档

---

## [v1.0.0] - 2025-01-13

### 新增功能 ⭐
- **网关测试缓存机制**
  - 10分钟短期缓存
  - 避免短时间内重复测速
  - 缓存过期自动刷新

- **文件完整性验证优化**
  - HEAD 请求快速验证（默认）
  - 完整哈希验证（备用）
  - 大文件验证时间从 30秒 降至 10秒

### 优化改进 🚀
- 网关测试并发优化（8个并发）
- 文件上传流程优化
- UI 界面优化

### 文档更新 📚
- 新增 `OPTIMIZATION_SUMMARY.md` - 优化总结文档
- 添加使用指南和验证方法

---

## 路线图 🗺️

### v2.1.0（计划中）
- [ ] 地理智能推荐（根据用户地理位置推荐最佳网关）
- [ ] 网关批量管理（导入/导出网关列表）
- [ ] 健康趋势可视化（图表展示网关状态变化）

### v3.0.0（计划中）
- [ ] 异常检测（自动识别异常波动的网关）
- [ ] A/B 测试（对比不同网关的实际下载速度）
- [ ] 增量哈希验证（分块计算哈希，边下载边验证）

---

## 注意事项 ⚠️

### 升级指南
- **v1.x → v2.0**：直接覆盖文件即可，数据向后兼容
- **健康状态迁移**：旧版缓存会自动升级到 `v2` 格式
- **配置兼容**：旧配置文件无需修改，新增配置项使用默认值

### 清理规则说明
- 默认网关（优先级 <= 10）不会被自动清理
- 自动清理功能默认关闭，推荐手动清理
- 清理后的网关无法恢复（除非重置）

### 缓存管理
- 测速缓存：10分钟（短期）
- 健康缓存：30天（长期）
- 网关列表：永久（直到手动清理）

---

**持续优化中...** 🚀

如有问题或建议，欢迎提 Issue 或 Pull Request！
